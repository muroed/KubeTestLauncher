# Exercism Test Runner API

Сервис API для оркестрации тест-раннеров Exercism в контейнерах Kubernetes.

## Описание

Этот API сервис принимает файлы с кодом и JSON конфигурации тестов через API-эндпоинты, запускает соответствующий языковой тест-раннер в Kubernetes pod/deployment, выполняет тесты и возвращает результаты тестов. Это решение включает только API без веб-интерфейса.

## Зависимости

- flask==2.3.3
- flask-sqlalchemy==3.1.1
- gunicorn==23.0.0
- kubernetes==29.0.0
- psycopg2-binary==2.9.9
- PyYAML==6.0.1
- Werkzeug==2.3.7
- email-validator==2.1.0

## Структура проекта

- `app.py` - Основное Flask приложение с API-маршрутами
- `k8s_client.py` - Kubernetes клиент с возможностью работы в режиме эмуляции
- `runner_service.py` - Сервисный слой для операций тест-раннера
- `main.py` - Точка входа в приложение
- `config.py` - Конфигурационные настройки
- `utils.py` - Утилитарные функции

## Запуск проекта

Сервер запускается с помощью Gunicorn:

```
gunicorn --bind 0.0.0.0:5000 --reuse-port --reload main:app
```

## API Endpoints

### GET /
Главная страница с документацией API.

### GET /health
Проверка состояния сервиса.

### POST /api/{language}-test-runner/start
Запускает тесты для указанного языка.

**Требуемые файлы:**
- `code_file`: Исходный код для тестирования
- `test_config`: JSON конфигурация для тестов

**Поддерживаемые языки:**
- python (возможно добавление других языков)

## Режим эмуляции Kubernetes

Приложение поддерживает режим эмуляции (mock mode) для разработки без подключения к Kubernetes. Режим эмуляции включается по умолчанию в среде разработки.

Чтобы отключить режим эмуляции, установите переменную окружения:
```
K8S_MOCK_MODE=false
```

## Тестирование API

Для тестирования API можно использовать скрипт `test-api.sh`:

```bash
./test-api.sh
```

Скрипт отправляет запросы к эндпоинтам `/health` и `/api/python-test-runner/start` для проверки работоспособности API.

## Тестовые файлы

- `test-python-code.py` - Пример Python кода для тестирования
- `test-config.json` - Пример конфигурации тестов
